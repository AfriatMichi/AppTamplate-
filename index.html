import React, { useState } from 'react';
import { Home, Search, Users, BookOpen, Settings, Plus, Edit, Trash2, ExternalLink, Save, X } from 'lucide-react';

const AndroidApp = () => {
  const [activeTab, setActiveTab] = useState('home');
  const [isAdminMode, setIsAdminMode] = useState(false);
  const [editingItem, setEditingItem] = useState(null);
  const [newItem, setNewItem] = useState({ title: '', url: '', icon: 'ExternalLink' });

  // נתוני האפליקציה
  const [appData, setAppData] = useState({
    home: [
      { id: 1, title: 'דף הבית', url: 'https://example.com/home', icon: 'Home' },
      { id: 2, title: 'חדשות', url: 'https://example.com/news', icon: 'Search' },
      { id: 3, title: 'אירועים', url: 'https://example.com/events', icon: 'Users' },
      { id: 4, title: 'מידע', url: 'https://example.com/info', icon: 'BookOpen' },
    ],
    explore: [
      { id: 5, title: 'גלריה', url: 'https://example.com/gallery', icon: 'Search' },
      { id: 6, title: 'מפות', url: 'https://example.com/maps', icon: 'ExternalLink' },
      { id: 7, title: 'סרטונים', url: 'https://example.com/videos', icon: 'Users' },
      { id: 8, title: 'מאמרים', url: 'https://example.com/articles', icon: 'BookOpen' },
    ],
    community: [
      { id: 9, title: 'פורום', url: 'https://example.com/forum', icon: 'Users' },
      { id: 10, title: 'צ\'אט', url: 'https://example.com/chat', icon: 'Users' },
      { id: 11, title: 'קבוצות', url: 'https://example.com/groups', icon: 'Users' },
      { id: 12, title: 'פרופיל', url: 'https://example.com/profile', icon: 'Users' },
    ],
    torah: [
      { id: 13, title: 'פרשת השבוע', url: 'https://example.com/parsha', icon: 'BookOpen' },
      { id: 14, title: 'דף יומי', url: 'https://example.com/daf', icon: 'BookOpen' },
      { id: 15, title: 'הלכות', url: 'https://example.com/halacha', icon: 'BookOpen' },
      { id: 16, title: 'שיעורים', url: 'https://example.com/shiurim', icon: 'BookOpen' },
      { id: 17, title: 'ספרייה', url: 'https://example.com/library', icon: 'BookOpen' },
    ]
  });

  const [webViewUrl, setWebViewUrl] = useState(null);

  // קונפיגורציה של הטאבים עם צבעים
  const tabs = [
    { id: 'home', label: 'בית', icon: Home, color: 'blue', bgGradient: 'from-blue-500 to-blue-600' },
    { id: 'explore', label: 'חקור', icon: Search, color: 'purple', bgGradient: 'from-purple-500 to-purple-600' },
    { id: 'community', label: 'קהילה', icon: Users, color: 'emerald', bgGradient: 'from-emerald-500 to-emerald-600' },
    { id: 'torah', label: 'תורה', icon: BookOpen, color: 'amber', bgGradient: 'from-amber-500 to-amber-600' },
  ];

  const iconMap = {
    Home: Home,
    Search: Search,
    Users: Users,
    BookOpen: BookOpen,
    ExternalLink: ExternalLink,
  };

  const getCurrentTabConfig = () => tabs.find(tab => tab.id === activeTab);

  const handleIconClick = (url) => {
    setWebViewUrl(url);
  };

  const handleAddItem = () => {
    if (newItem.title && newItem.url) {
      const newId = Math.max(...Object.values(appData).flat().map(item => item.id)) + 1;
      setAppData(prev => ({
        ...prev,
        [activeTab]: [...prev[activeTab], { ...newItem, id: newId }]
      }));
      setNewItem({ title: '', url: '', icon: 'ExternalLink' });
    }
  };

  const handleEditItem = (item) => {
    setEditingItem(item);
  };

  const handleSaveEdit = () => {
    setAppData(prev => ({
      ...prev,
      [activeTab]: prev[activeTab].map(item => 
        item.id === editingItem.id ? editingItem : item
      )
    }));
    setEditingItem(null);
  };

  const handleDeleteItem = (id) => {
    setAppData(prev => ({
      ...prev,
      [activeTab]: prev[activeTab].filter(item => item.id !== id)
    }));
  };

  const IconComponent = ({ iconName, size = 24, className = "" }) => {
    const Icon = iconMap[iconName] || ExternalLink;
    return <Icon size={size} className={className} />;
  };

  if (webViewUrl) {
    const currentTab = getCurrentTabConfig();
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
        {/* כותרת WebView */}
        <div className={`bg-gradient-to-r ${currentTab.bgGradient} text-white p-4 flex items-center justify-between shadow-lg`}>
          <button
            onClick={() => setWebViewUrl(null)}
            className="p-2 hover:bg-white/20 rounded-full transition-colors"
          >
            <X size={24} />
          </button>
          <h1 className="text-lg font-bold">דפדפן</h1>
          <div className="w-10"></div>
        </div>
        
        {/* WebView מדומה */}
        <div className="flex-1 bg-white m-6 rounded-2xl shadow-2xl border border-gray-100 overflow-hidden">
          <div className="bg-gray-50 p-3 border-b border-gray-200 flex items-center gap-3">
            <div className="flex gap-2">
              <div className="w-3 h-3 bg-red-400 rounded-full"></div>
              <div className="w-3 h-3 bg-yellow-400 rounded-full"></div>
              <div className="w-3 h-3 bg-green-400 rounded-full"></div>
            </div>
            <div className="flex-1 bg-white rounded-full px-3 py-1 text-sm text-gray-600 truncate">
              {webViewUrl}
            </div>
          </div>
          <div className="p-12 text-center">
            <div className={`w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-br ${currentTab.bgGradient} flex items-center justify-center`}>
              <ExternalLink size={40} className="text-white" />
            </div>
            <h2 className="text-2xl font-bold mb-4 text-gray-800">טוען דף...</h2>
            <p className="text-gray-600 mb-6 text-lg">{webViewUrl}</p>
            <div className="bg-gray-50 rounded-xl p-6 max-w-md mx-auto">
              <p className="text-sm text-gray-500">
                במציאות, כאן יוצג הדף הרצוי בתוך האפליקציה
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  }

  const currentTab = getCurrentTabConfig();

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col">
      {/* כותרת */}
      <div className={`bg-gradient-to-r ${currentTab.bgGradient} text-white p-6 flex items-center justify-between shadow-lg`}>
        <div>
          <h1 className="text-2xl font-bold mb-1">{currentTab.label}</h1>
          <p className="text-white/80 text-sm">גלה את התוכן שלנו</p>
        </div>
        <button
          onClick={() => setIsAdminMode(!isAdminMode)}
          className={`p-3 rounded-full transition-all duration-300 ${
            isAdminMode 
              ? 'bg-white/20 text-white shadow-lg' 
              : 'bg-white/10 text-white/80 hover:bg-white/20 hover:text-white'
          }`}
        >
          <Settings size={24} />
        </button>
      </div>

      {/* תוכן ראשי */}
      <div className="flex-1 p-6">
        {isAdminMode ? (
          <div className="space-y-8">
            {/* הוספת פריט חדש */}
            <div className="bg-white rounded-2xl p-8 shadow-xl border border-gray-100">
              <div className="flex items-center gap-3 mb-6">
                <div className={`w-10 h-10 rounded-full bg-gradient-to-br ${currentTab.bgGradient} flex items-center justify-center`}>
                  <Plus size={20} className="text-white" />
                </div>
                <h3 className="text-xl font-bold text-gray-800">הוסף פריט חדש</h3>
              </div>
              <div className="space-y-5">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">כותרת</label>
                  <input
                    type="text"
                    placeholder="הכנס כותרת..."
                    value={newItem.title}
                    onChange={(e) => setNewItem({...newItem, title: e.target.value})}
                    className="w-full p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">קישור</label>
                  <input
                    type="url"
                    placeholder="https://example.com"
                    value={newItem.url}
                    onChange={(e) => setNewItem({...newItem, url: e.target.value})}
                    className="w-full p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">אייקון</label>
                  <select
                    value={newItem.icon}
                    onChange={(e) => setNewItem({...newItem, icon: e.target.value})}
                    className="w-full p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                  >
                    <option value="ExternalLink">קישור חיצוני</option>
                    <option value="Home">בית</option>
                    <option value="Search">חיפוש</option>
                    <option value="Users">משתמשים</option>
                    <option value="BookOpen">ספר</option>
                  </select>
                </div>
                <button
                  onClick={handleAddItem}
                  className={`w-full bg-gradient-to-r ${currentTab.bgGradient} text-white p-4 rounded-xl hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-3 font-semibold`}
                >
                  <Plus size={20} />
                  הוסף פריט
                </button>
              </div>
            </div>

            {/* רשימת פריטים לעריכה */}
            <div className="bg-white rounded-2xl p-8 shadow-xl border border-gray-100">
              <div className="flex items-center gap-3 mb-6">
                <div className={`w-10 h-10 rounded-full bg-gradient-to-br ${currentTab.bgGradient} flex items-center justify-center`}>
                  <Edit size={20} className="text-white" />
                </div>
                <h3 className="text-xl font-bold text-gray-800">ערוך פריטים קיימים</h3>
              </div>
              <div className="space-y-4">
                {appData[activeTab].map((item) => (
                  <div key={item.id} className="flex items-center justify-between p-5 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border border-gray-200 hover:shadow-md transition-all duration-300">
                    <div className="flex items-center gap-4">
                      <div className={`w-12 h-12 rounded-full bg-gradient-to-br ${currentTab.bgGradient} flex items-center justify-center`}>
                        <IconComponent iconName={item.icon} size={20} className="text-white" />
                      </div>
                      <div>
                        <h4 className="font-bold text-gray-800">{item.title}</h4>
                        <p className="text-sm text-gray-600 truncate max-w-xs">{item.url}</p>
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => handleEditItem(item)}
                        className="p-3 text-blue-600 hover:bg-blue-100 rounded-full transition-colors"
                      >
                        <Edit size={18} />
                      </button>
                      <button
                        onClick={() => handleDeleteItem(item.id)}
                        className="p-3 text-red-600 hover:bg-red-100 rounded-full transition-colors"
                      >
                        <Trash2 size={18} />
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        ) : (
          <div className="grid grid-cols-2 gap-6">
            {appData[activeTab].map((item) => (
              <div
                key={item.id}
                onClick={() => handleIconClick(item.url)}
                className="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 hover:shadow-xl hover:scale-105 transition-all duration-300 cursor-pointer flex flex-col items-center text-center group"
              >
                <div className={`w-20 h-20 rounded-2xl bg-gradient-to-br ${currentTab.bgGradient} flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300`}>
                  <IconComponent iconName={item.icon} size={32} className="text-white" />
                </div>
                <h3 className="text-lg font-bold text-gray-800 mb-2">{item.title}</h3>
                <p className="text-sm text-gray-500 truncate w-full opacity-70">{item.url}</p>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* ניווט תחתון */}
      <div className="bg-white/90 backdrop-blur-sm border-t border-gray-200 px-6 py-4 shadow-lg">
        <div className="flex justify-around">
          {tabs.map((tab) => {
            const Icon = tab.icon;
            const isActive = activeTab === tab.id;
            return (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex flex-col items-center py-3 px-4 rounded-xl transition-all duration-300 ${
                  isActive
                    ? `text-${tab.color}-600 bg-${tab.color}-50 shadow-lg`
                    : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
                }`}
              >
                <Icon size={26} className={`mb-1 ${isActive ? 'animate-pulse' : ''}`} />
                <span className={`text-xs font-bold ${isActive ? 'text-gray-800' : 'text-gray-600'}`}>
                  {tab.label}
                </span>
              </button>
            );
          })}
        </div>
      </div>

      {/* חלון עריכה */}
      {editingItem && (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-2xl p-8 w-full max-w-md shadow-2xl">
            <div className="flex items-center gap-3 mb-6">
              <div className={`w-10 h-10 rounded-full bg-gradient-to-br ${currentTab.bgGradient} flex items-center justify-center`}>
                <Edit size={20} className="text-white" />
              </div>
              <h3 className="text-xl font-bold text-gray-800">ערוך פריט</h3>
            </div>
            <div className="space-y-5">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">כותרת</label>
                <input
                  type="text"
                  value={editingItem.title}
                  onChange={(e) => setEditingItem({...editingItem, title: e.target.value})}
                  className="w-full p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">קישור</label>
                <input
                  type="url"
                  value={editingItem.url}
                  onChange={(e) => setEditingItem({...editingItem, url: e.target.value})}
                  className="w-full p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">אייקון</label>
                <select
                  value={editingItem.icon}
                  onChange={(e) => setEditingItem({...editingItem, icon: e.target.value})}
                  className="w-full p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                >
                  <option value="ExternalLink">קישור חיצוני</option>
                  <option value="Home">בית</option>
                  <option value="Search">חיפוש</option>
                  <option value="Users">משתמשים</option>
                  <option value="BookOpen">ספר</option>
                </select>
              </div>
              <div className="flex gap-3 pt-4">
                <button
                  onClick={handleSaveEdit}
                  className={`flex-1 bg-gradient-to-r ${currentTab.bgGradient} text-white p-4 rounded-xl hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2 font-semibold`}
                >
                  <Save size={20} />
                  שמור
                </button>
                <button
                  onClick={() => setEditingItem(null)}
                  className="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 text-white p-4 rounded-xl hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2 font-semibold"
                >
                  <X size={20} />
                  ביטול
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default AndroidApp;
